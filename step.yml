#
# A couple of useful guides & docs:
#
# - Main Bitrise CLI docs: https://github.com/bitrise-io/bitrise/tree/master/_docs
# - Step Development Guideline: https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
# - Bitrise.yml format spec: https://github.com/bitrise-io/bitrise/blob/master/_docs/bitrise-yml-format-spec.md
# - Bitrise docs: http://devcenter.bitrise.io/
# - Bitrise CLI guides: http://devcenter.bitrise.io/bitrise-cli/

title: |-
  Jira Comments
summary: |
  Creates comments for all tasks from pull request merge commits. It uses the commit message to determine which tasks should be commented.
description: |
  This steps scans last merge commits or last commit if it is not a merge commit, and gathers all Jira tasks names found in commit messages.
  Once the tasks are found it uses the credentials provided to use Jira API and posts a comment for each found task.
  
  The regex pattern to look for Jira tasks is "<project_prefix>[0-9]{1,5}"
  
  This step is using Jira API v2.
website: https://github.com/DroidsOnRoids/bitrise_step_build_info_jira_comment
source_code_url: https://github.com/DroidsOnRoids/bitrise_step_build_info_jira_comment
support_url: https://github.com/DroidsOnRoids/bitrise_step_build_info_jira_comment/issues
host_os_tags:
  - osx-10.10
  - ubuntu-16.04

# If this step should be available only for certain project types
# just uncomment this `project_type_tags` section and include all the
# project types supported by the step. If the step can be used for all
# project types then you can just remove this section.
# If no `project_type_tags` specified (or specified as an empty array)
# that means the step can be used for any project type.
# You can find more information about project type tags in the Step Development Guideline:
# https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
#
# project_type_tags:
#   - ios
#   - macos
#   - android
#   - xamarin
#   - react-native
#   - cordova
#   - ionic

# Type tags are used for categorizing steps, for easier step discovery in Step Libraries.
# You can find more information about type tags in the Step Development Guideline:
# https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
type_tags:
  - utility

is_requires_admin_user: false
is_always_run: false
is_skippable: false
run_if: ""

deps:
  brew:
  - name: git
  apt_get:
  - name: git

toolkit:
  bash:
    entry_file: step.sh


inputs:
  - jira_project_prefixes:
    opts:
      title: "Jira project prefixes"
      description: |
        Project prefix to search for tasks separatad with `|`.
        
        e.g. "PROJ-"
      is_expand: true
      is_required: true
      value_options: []
  - jira_domain:
    opts:
      title: "Jira domain"
      description: |
        Jira company domain.
      
        e.g. "example.atlassian.net"
      is_sensitive: true
      is_expand: true
      is_required: true
  - jira_user:
    opts:
      title: "Jira user"
      description: |
        Jira user used to authenticate with Jira API
        
        e.g. "someone@example.pl"
      is_sensitive: true
      is_expand: true
      is_required: true
  - jira_token:
    opts:
      title: "Jira user token"
      description: |
        Jira user token used to authenticate with Jira API
        
        24 character string
      is_sensitive: true
      is_expand: true
      is_required: true
  - jira_comment:
    opts:
      title: "Comment"
      description: "Comment that will be posted for each found Jira task"
  - jira_issue_field_name:
    opts:
      title: "Jira issue field name"
      summary: "The name of the field you want to update"
#      is_required: true
      description: |
        The name of the field you want to update. This is the field name NOT field description.

        To find the name of the field you need admin access to "Screens" page for your Jira project.
  - jira_issue_field_value:
    opts:
      title: "Jira issue field value to update"
      summary: "Value to update the issue field with."
      is_required: true
      description: |
        Value to update the issue field with.
        
        Currently works only with simple string/number types
  - jira_project_name: ""
    opts:
      title: "Jira project name"
      summary: "Acronym used in Jira e.g. TEMP, GAS, TEST"
      description: |
        This will be used by script to determine tasks ids in git log e.g. TEST-123
      is_expand: true
#      is_required: true
  - jira_from_status: "Peer Review"
    opts:
      title: "Initial status"
      summary: "Initial status of tasks to be changed"
      description: |
        Initial status of tasks to be changed
      is_expand: true
#      is_required: true
  - jira_to_status: "Merged"
    opts:
      title: "Target status"
      summary: "Target status of tasks to be set"
      description: |
        Target status of tasks to be set
      is_expand: true
#      is_required: true
  - show_debug_logs: "no"
    opts:
      category: Debug
      title: "Show debug logs?"
      description: |
        If debug=yes the step will print debug infos
      value_options:
        - "no"
        - "yes"
